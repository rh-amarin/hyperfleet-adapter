{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://hyperfleet.io/schemas/hyperfleet-adapter-values",
  "title": "HyperFleet Adapter Helm Values",
  "description": "JSON Schema for HyperFleet Adapter Helm chart values",
  "type": "object",
  "properties": {
    "replicaCount": {
      "type": "integer",
      "minimum": 0,
      "default": 1,
      "description": "Number of replicas for the adapter deployment"
    },
    "image": {
      "type": "object",
      "description": "Container image configuration",
      "properties": {
        "registry": {
          "type": "string",
          "default": "quay.io/openshift-hyperfleet",
          "description": "Container image registry"
        },
        "repository": {
          "type": "string",
          "default": "hyperfleet-adapter",
          "description": "Container image repository"
        },
        "pullPolicy": {
          "type": "string",
          "enum": ["Always", "IfNotPresent", "Never"],
          "default": "Always",
          "description": "Image pull policy"
        },
        "tag": {
          "type": "string",
          "default": "latest",
          "description": "Container image tag"
        }
      }
    },
    "imagePullSecrets": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          }
        }
      },
      "default": [],
      "description": "Image pull secrets for private registries"
    },
    "nameOverride": {
      "type": "string",
      "default": "",
      "description": "Override the chart name"
    },
    "fullnameOverride": {
      "type": "string",
      "default": "",
      "description": "Override the full release name"
    },
    "adapter": {
      "type": "object",
      "description": "Adapter type configuration for flexible naming and labeling",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["", "namespace", "job", "manifestwork", "maestro", "generic"],
          "default": "",
          "description": "Adapter type identifier for labeling (namespace, job, manifestwork, maestro, generic)"
        },
        "name": {
          "type": "string",
          "default": "",
          "description": "Adapter name (optional, defaults to adapter type)"
        }
      }
    },
    "deploymentLabels": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "default": {},
      "description": "Additional labels for the deployment"
    },
    "deploymentAnnotations": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "default": {},
      "description": "Additional annotations for the deployment"
    },
    "podLabels": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "default": {},
      "description": "Additional labels for pods"
    },
    "strategy": {
      "type": "object",
      "description": "Deployment update strategy",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["RollingUpdate", "Recreate"],
          "default": "RollingUpdate"
        },
        "rollingUpdate": {
          "type": "object",
          "properties": {
            "maxSurge": {
              "oneOf": [
                {"type": "integer", "minimum": 0},
                {"type": "string", "pattern": "^\\d+%$"}
              ]
            },
            "maxUnavailable": {
              "oneOf": [
                {"type": "integer", "minimum": 0},
                {"type": "string", "pattern": "^\\d+%$"}
              ]
            }
          }
        }
      }
    },
    "minReadySeconds": {
      "type": "integer",
      "minimum": 0,
      "default": 0,
      "description": "Minimum seconds for a newly created pod to be ready"
    },
    "revisionHistoryLimit": {
      "type": "integer",
      "minimum": 0,
      "default": 10,
      "description": "Number of old ReplicaSets to retain for rollback"
    },
    "containerPorts": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "containerPort": {"type": "integer", "minimum": 1, "maximum": 65535},
          "protocol": {"type": "string", "enum": ["TCP", "UDP", "SCTP"]}
        },
        "required": ["name", "containerPort"]
      },
      "description": "Container ports for health and metrics endpoints"
    },
    "command": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Override default container command"
    },
    "args": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Override default container args"
    },
    "serviceAccount": {
      "type": "object",
      "description": "ServiceAccount configuration",
      "properties": {
        "create": {
          "type": "boolean",
          "default": true,
          "description": "Specifies whether a service account should be created"
        },
        "annotations": {
          "type": "object",
          "additionalProperties": {"type": "string"},
          "default": {},
          "description": "Annotations to add to the service account (e.g., for GCP Workload Identity)"
        },
        "name": {
          "type": "string",
          "default": "",
          "description": "The name of the service account to use"
        }
      }
    },
    "podAnnotations": {
      "type": "object",
      "additionalProperties": {"type": "string"},
      "default": {},
      "description": "Annotations to add to pods"
    },
    "podSecurityContext": {
      "type": "object",
      "description": "Pod security context",
      "properties": {
        "fsGroup": {"type": "integer"},
        "runAsNonRoot": {"type": "boolean"},
        "runAsUser": {"type": "integer"},
        "runAsGroup": {"type": "integer"},
        "supplementalGroups": {
          "type": "array",
          "items": {"type": "integer"}
        }
      }
    },
    "securityContext": {
      "type": "object",
      "description": "Container security context",
      "properties": {
        "allowPrivilegeEscalation": {"type": "boolean"},
        "capabilities": {
          "type": "object",
          "properties": {
            "add": {"type": "array", "items": {"type": "string"}},
            "drop": {"type": "array", "items": {"type": "string"}}
          }
        },
        "readOnlyRootFilesystem": {"type": "boolean"},
        "runAsNonRoot": {"type": "boolean"},
        "runAsUser": {"type": "integer"},
        "seccompProfile": {
          "type": "object",
          "properties": {
            "type": {"type": "string", "enum": ["RuntimeDefault", "Localhost", "Unconfined"]}
          }
        }
      }
    },
    "resources": {
      "type": "object",
      "description": "Resource requests and limits",
      "properties": {
        "limits": {
          "type": "object",
          "properties": {
            "cpu": {"type": "string"},
            "memory": {"type": "string"}
          }
        },
        "requests": {
          "type": "object",
          "properties": {
            "cpu": {"type": "string"},
            "memory": {"type": "string"}
          }
        }
      }
    },
    "livenessProbe": {
      "type": "object",
      "description": "Liveness probe configuration",
      "properties": {
        "enabled": {"type": "boolean", "default": true},
        "httpGet": {
          "type": "object",
          "properties": {
            "path": {"type": "string"},
            "port": {"oneOf": [{"type": "integer"}, {"type": "string"}]},
            "scheme": {"type": "string", "enum": ["HTTP", "HTTPS"]}
          }
        },
        "tcpSocket": {
          "type": "object",
          "properties": {
            "port": {"oneOf": [{"type": "integer"}, {"type": "string"}]}
          }
        },
        "exec": {
          "type": "object",
          "properties": {
            "command": {"type": "array", "items": {"type": "string"}}
          }
        },
        "initialDelaySeconds": {"type": "integer", "minimum": 0},
        "periodSeconds": {"type": "integer", "minimum": 1},
        "timeoutSeconds": {"type": "integer", "minimum": 1},
        "failureThreshold": {"type": "integer", "minimum": 1},
        "successThreshold": {"type": "integer", "minimum": 1}
      }
    },
    "readinessProbe": {
      "type": "object",
      "description": "Readiness probe configuration",
      "properties": {
        "enabled": {"type": "boolean", "default": true},
        "httpGet": {
          "type": "object",
          "properties": {
            "path": {"type": "string"},
            "port": {"oneOf": [{"type": "integer"}, {"type": "string"}]},
            "scheme": {"type": "string", "enum": ["HTTP", "HTTPS"]}
          }
        },
        "tcpSocket": {
          "type": "object",
          "properties": {
            "port": {"oneOf": [{"type": "integer"}, {"type": "string"}]}
          }
        },
        "exec": {
          "type": "object",
          "properties": {
            "command": {"type": "array", "items": {"type": "string"}}
          }
        },
        "initialDelaySeconds": {"type": "integer", "minimum": 0},
        "periodSeconds": {"type": "integer", "minimum": 1},
        "timeoutSeconds": {"type": "integer", "minimum": 1},
        "failureThreshold": {"type": "integer", "minimum": 1},
        "successThreshold": {"type": "integer", "minimum": 1}
      }
    },
    "startupProbe": {
      "type": "object",
      "description": "Startup probe configuration",
      "properties": {
        "enabled": {"type": "boolean", "default": false},
        "httpGet": {
          "type": "object",
          "properties": {
            "path": {"type": "string"},
            "port": {"oneOf": [{"type": "integer"}, {"type": "string"}]},
            "scheme": {"type": "string", "enum": ["HTTP", "HTTPS"]}
          }
        },
        "tcpSocket": {
          "type": "object",
          "properties": {
            "port": {"oneOf": [{"type": "integer"}, {"type": "string"}]}
          }
        },
        "exec": {
          "type": "object",
          "properties": {
            "command": {"type": "array", "items": {"type": "string"}}
          }
        },
        "initialDelaySeconds": {"type": "integer", "minimum": 0},
        "periodSeconds": {"type": "integer", "minimum": 1},
        "timeoutSeconds": {"type": "integer", "minimum": 1},
        "failureThreshold": {"type": "integer", "minimum": 1},
        "successThreshold": {"type": "integer", "minimum": 1}
      }
    },
    "lifecycle": {
      "type": "object",
      "description": "Lifecycle hooks for the container",
      "properties": {
        "preStop": {"type": "object"},
        "postStart": {"type": "object"}
      }
    },
    "priorityClassName": {
      "type": "string",
      "default": "",
      "description": "Priority class name for pod scheduling"
    },
    "terminationGracePeriodSeconds": {
      "type": "integer",
      "minimum": 0,
      "default": 30,
      "description": "Termination grace period in seconds"
    },
    "hostNetwork": {
      "type": "boolean",
      "default": false,
      "description": "Use host network"
    },
    "dnsPolicy": {
      "type": "string",
      "enum": ["", "Default", "ClusterFirst", "ClusterFirstWithHostNet", "None"],
      "default": "",
      "description": "DNS policy for the pod"
    },
    "dnsConfig": {
      "type": "object",
      "description": "Custom DNS configuration",
      "properties": {
        "nameservers": {"type": "array", "items": {"type": "string"}},
        "searches": {"type": "array", "items": {"type": "string"}},
        "options": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "value": {"type": "string"}
            }
          }
        }
      }
    },
    "initContainers": {
      "type": "array",
      "items": {"type": "object"},
      "default": [],
      "description": "Init containers"
    },
    "sidecarContainers": {
      "type": "array",
      "items": {"type": "object"},
      "default": [],
      "description": "Sidecar containers"
    },
    "nodeSelector": {
      "type": "object",
      "additionalProperties": {"type": "string"},
      "default": {},
      "description": "Node selector for pod scheduling"
    },
    "tolerations": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "key": {"type": "string"},
          "operator": {"type": "string", "enum": ["Exists", "Equal"]},
          "value": {"type": "string"},
          "effect": {"type": "string", "enum": ["NoSchedule", "PreferNoSchedule", "NoExecute"]},
          "tolerationSeconds": {"type": "integer"}
        }
      },
      "default": [],
      "description": "Tolerations for pod scheduling"
    },
    "affinity": {
      "type": "object",
      "default": {},
      "description": "Affinity rules for pod scheduling"
    },
    "topologySpreadConstraints": {
      "type": "array",
      "items": {"type": "object"},
      "default": [],
      "description": "Topology spread constraints for pod distribution"
    },
    "autoscaling": {
      "type": "object",
      "description": "Horizontal Pod Autoscaler configuration",
      "properties": {
        "enabled": {"type": "boolean", "default": false},
        "minReplicas": {"type": "integer", "minimum": 1, "default": 1},
        "maxReplicas": {"type": "integer", "minimum": 1, "default": 10},
        "targetCPUUtilizationPercentage": {"type": "integer", "minimum": 1, "maximum": 100},
        "targetMemoryUtilizationPercentage": {"type": "integer", "minimum": 1, "maximum": 100}
      }
    },
    "config": {
      "type": "object",
      "description": "Adapter configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable adapter ConfigMap"
        },
        "configMapName": {
          "type": "string",
          "default": "",
          "description": "Custom ConfigMap name"
        },
        "adapterType": {
          "type": "string",
          "default": "",
          "description": "Adapter type identifier (e.g., example, gcp, aws)"
        },
        "env": {
          "type": "object",
          "additionalProperties": {"type": "string"},
          "default": {},
          "description": "Environment variables for ConfigMap"
        },
        "adapterYaml": {
          "type": "string",
          "default": "",
          "description": "Adapter YAML config content"
        }
      }
    },
    "broker": {
      "type": "object",
      "description": "Broker configuration",
      "properties": {
        "create": {
          "type": "boolean",
          "default": false,
          "description": "Create a broker ConfigMap"
        },
        "configMapName": {
          "type": "string",
          "default": "",
          "description": "Broker ConfigMap name"
        },
        "type": {
          "type": "string",
          "enum": ["", "googlepubsub", "rabbitmq", "kafka"],
          "default": "",
          "description": "Broker type identifier"
        },
        "subscriptionId": {
          "type": "string",
          "default": "",
          "description": "Subscription ID for the adapter to consume from"
        },
        "topic": {
          "type": "string",
          "default": "",
          "description": "Topic for the adapter to consume from"
        },
        "env": {
          "type": "object",
          "additionalProperties": {"type": "string"},
          "default": {},
          "description": "Additional broker environment variables"
        },
        "yaml": {
          "type": "string",
          "default": "",
          "description": "Broker YAML configuration file content"
        },
        "mountAsEnv": {
          "type": "boolean",
          "default": true,
          "description": "Mount broker ConfigMap env vars via envFrom"
        },
        "envKeys": {
          "type": "array",
          "items": {"type": "string"},
          "default": [],
          "description": "Specific environment variable keys to mount from broker ConfigMap"
        }
      }
    },
    "hyperfleetApi": {
      "type": "object",
      "description": "HyperFleet API configuration",
      "properties": {
        "baseUrl": {
          "type": "string",
          "default": "",
          "description": "Base URL for HyperFleet API"
        },
        "version": {
          "type": "string",
          "default": "v1",
          "description": "API version"
        }
      }
    },
    "env": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "value": {"type": "string"},
          "valueFrom": {
            "type": "object",
            "properties": {
              "secretKeyRef": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "key": {"type": "string"}
                }
              },
              "configMapKeyRef": {
                "type": "object",
                "properties": {
                  "name": {"type": "string"},
                  "key": {"type": "string"}
                }
              },
              "fieldRef": {
                "type": "object",
                "properties": {
                  "fieldPath": {"type": "string"}
                }
              }
            }
          }
        },
        "required": ["name"]
      },
      "default": [],
      "description": "Environment variables"
    },
    "envFrom": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "configMapRef": {
            "type": "object",
            "properties": {"name": {"type": "string"}}
          },
          "secretRef": {
            "type": "object",
            "properties": {"name": {"type": "string"}}
          }
        }
      },
      "default": [],
      "description": "envFrom for loading entire ConfigMaps/Secrets as environment variables"
    },
    "extraVolumeMounts": {
      "type": "array",
      "items": {"type": "object"},
      "default": [],
      "description": "Volume mounts for additional configs"
    },
    "extraVolumes": {
      "type": "array",
      "items": {"type": "object"},
      "default": [],
      "description": "Additional volumes"
    },
    "podDisruptionBudget": {
      "type": "object",
      "description": "Pod Disruption Budget configuration",
      "properties": {
        "enabled": {"type": "boolean", "default": false},
        "minAvailable": {
          "oneOf": [
            {"type": "integer", "minimum": 0},
            {"type": "string", "pattern": "^\\d+%$"}
          ]
        },
        "maxUnavailable": {
          "oneOf": [
            {"type": "integer", "minimum": 0},
            {"type": "string", "pattern": "^\\d+%$"}
          ]
        },
        "unhealthyPodEvictionPolicy": {
          "type": "string",
          "enum": ["IfHealthyBudget", "AlwaysAllow"]
        }
      }
    }
  }
}
