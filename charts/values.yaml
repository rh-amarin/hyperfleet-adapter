# Default values for hyperfleet-adapter
# This is a YAML-formatted file.

## Application configuration section
## ================================
# AdapterConfig can be created:
# - option1: from an existing ConfigMap by setting configMapName
# - option2: from a YAML file by setting yaml
# - option3: from a set of files by setting files
adapterConfig:
  create: true

  # option1: ConfigMap name (if different from default, and set create: false)
  #configMapName: ""

  # option2: Adapter YAML configuration (creates adapterconfig.yaml key in ConfigMap)
  # yaml: 
  #  apiVersion: hyperfleet.redhat.com/v1alpha1
  #  kind: AdapterConfig

  # option3: Task YAML files packaged with the chart
  # files:
    # adapterconfig.yaml: examples/provider-adapterconfig.yaml
    # deployment.yaml: examples/provider-deployment.yaml
  # HyperFleet API configuration
  hyperfleetApi:
    # Base URL for HyperFleet API (HYPERFLEET_API_BASE_URL)
    baseUrl: http://hyperfleet-api:8000
    # API version (HYPERFLEET_API_VERSION), default: v1
    version: "v1"

  log:
    level: info


# Broker configuration can be created:
# - option1: from an existing ConfigMap by setting configMapName
# - option2: from a YAML file by setting yaml
# - option3: from a set of properties under broker.googlepubsub, broker.rabbitmq, etc.
broker:
  create: true
  # option1
  # configMapName: ""
  
  # option2
  # yaml: ""

  # option3: Broker type identifier (googlepubsub, rabbitmq, etc.) - used as label
  # Subscription ID for the adapter to consume from (BROKER_SUBSCRIPTION_ID env var)
  googlepubsub:
    projectId: ""
    subscriptionId: ""
    topic: ""
    deadLetterTopic: ""
  # option3: for rabbitmq
  #rabbitmq:
  # url: ""
  # queue: ""
  # exchange: ""
  # routingKey: ""



## Kubernetes configuration section
## ================================

replicaCount: 1

# This is the image for the adapter framework
image:
  registry: CHANGE_ME # e.g. quay.io/openshift-hyperfleet
  repository: CHANGE_ME # e.g. hyperfleet-adapter
  pullPolicy: Always
  tag: CHANGE_ME # e.g. "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Deployment configuration
deploymentLabels: {}
deploymentAnnotations: {}

# Pod labels (in addition to selector labels)
podLabels: {}

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# Minimum number of seconds for which a newly created pod should be ready
minReadySeconds: 0

# The number of old ReplicaSets to retain for rollback
revisionHistoryLimit: 10

# Container ports for health and metrics endpoints
containerPorts:
  - name: http
    containerPort: 8080
    protocol: TCP
  - name: metrics
    containerPort: 9090
    protocol: TCP

# Override default command
command:
  - /app/adapter

# Override default args
args:
  - serve
  - --config
  - /etc/adapter/adapterconfig.yaml

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# RBAC permissions are needed if the adapter task needs to interact with CLM cluster
# e.g. if triggering a job that must update its status to report conditions
rbac:
  create: true
  # Resources to grant full access (get, list, watch, create, update, patch, delete)
  # apiGroup is auto-detected based on resource type
  # resources:
  #   - namespaces
  #   - serviceaccounts
  #   - configmaps
  #   - deployments
  #   - pods
  #   - roles
  #   - rolebindings
  #   - jobs
  #   - jobs/status
  # Additional custom rules (appended to auto-generated rules)
  rules: []

podAnnotations: {}

podSecurityContext:
  fsGroup: 65532
  runAsNonRoot: true
  runAsUser: 65532

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true
  seccompProfile:
    type: RuntimeDefault

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Liveness probe configuration (per HyperFleet health-endpoints standard)
# Uses K8s defaults: initialDelaySeconds=0, periodSeconds=10, timeoutSeconds=1, failureThreshold=3
livenessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: 8080

# Readiness probe configuration (per HyperFleet health-endpoints standard)
# Uses K8s defaults: initialDelaySeconds=0, periodSeconds=10, timeoutSeconds=1, failureThreshold=3
readinessProbe:
  enabled: true
  httpGet:
    path: /readyz
    port: 8080

# Startup probe configuration (useful for slow-starting containers)
# Uses K8s defaults when enabled
startupProbe:
  enabled: false
  httpGet:
    path: /healthz
    port: 8080

# Lifecycle hooks
lifecycle: {}
  # preStop:
  #   exec:
  #     command:
  #       - /bin/sh
  #       - -c
  #       - sleep 10

# Priority class name for pod scheduling
priorityClassName: ""

# Termination grace period in seconds
terminationGracePeriodSeconds: 30

# Init containers
initContainers: []
  # - name: init-myservice
  #   image: busybox:1.28
  #   command: ['sh', '-c', 'until nslookup myservice; do echo waiting; sleep 2; done']

# Sidecar containers
sidecarContainers: []
  # - name: sidecar
  #   image: nginx:1.19
  #   ports:
  #     - containerPort: 80

nodeSelector: {}

tolerations: []

affinity: {}

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80


# Environment variables
env: []
  # - name: ADAPTER_CONFIG_PATH
  #   value: /path/to/custom/config.yaml
  # - name: MY_SECRET
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: secret-key

# envFrom for loading entire ConfigMaps/Secrets as environment variables
envFrom: []
  # - configMapRef:
  #     name: my-configmap
  # - secretRef:
  #     name: my-secret

# Volume mounts for additional configs
extraVolumeMounts: []
  # - name: custom-config
  #   mountPath: /etc/custom
  #   readOnly: true

# Additional volumes
extraVolumes: []
  # - name: custom-config
  #   configMap:
  #     name: custom-configmap

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  # minAvailable: 1
  # maxUnavailable: 1
  # unhealthyPodEvictionPolicy: IfHealthyBudget
