# Default values for hyperfleet-adapter
# This is a YAML-formatted file.

replicaCount: 1

image:
  registry: quay.io/openshift-hyperfleet
  repository: hyperfleet-adapter
  pullPolicy: Always
  tag: "latest"

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Deployment configuration
deploymentLabels: {}
deploymentAnnotations: {}

# Pod labels (in addition to selector labels)
podLabels: {}

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# Minimum number of seconds for which a newly created pod should be ready
minReadySeconds: 0

# The number of old ReplicaSets to retain for rollback
revisionHistoryLimit: 10

# Container ports for health and metrics endpoints
containerPorts:
  - name: http
    containerPort: 8080
    protocol: TCP
  - name: metrics
    containerPort: 9090
    protocol: TCP

# Override default command
command:
  - /app/adapter

# Override default args
args:
  - serve

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  # For GCP Workload Identity Federation (WIF), add:
  #   iam.gke.io/gcp-service-account: GSA_NAME@PROJECT_ID.iam.gserviceaccount.com
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext:
  fsGroup: 65532
  runAsNonRoot: true
  runAsUser: 65532

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true
  seccompProfile:
    type: RuntimeDefault

resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Liveness probe configuration (per HyperFleet health-endpoints standard)
# Uses K8s defaults: initialDelaySeconds=0, periodSeconds=10, timeoutSeconds=1, failureThreshold=3
livenessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: 8080

# Readiness probe configuration (per HyperFleet health-endpoints standard)
# Uses K8s defaults: initialDelaySeconds=0, periodSeconds=10, timeoutSeconds=1, failureThreshold=3
readinessProbe:
  enabled: true
  httpGet:
    path: /readyz
    port: 8080

# Startup probe configuration (useful for slow-starting containers)
# Uses K8s defaults when enabled
startupProbe:
  enabled: false
  httpGet:
    path: /healthz
    port: 8080

# Lifecycle hooks
lifecycle: {}
  # preStop:
  #   exec:
  #     command:
  #       - /bin/sh
  #       - -c
  #       - sleep 10

# Priority class name for pod scheduling
priorityClassName: ""

# Termination grace period in seconds
terminationGracePeriodSeconds: 30

# Use host network
hostNetwork: false

# DNS policy for the pod
dnsPolicy: ""

# Custom DNS configuration
dnsConfig: {}
  # nameservers:
  #   - 8.8.8.8
  # searches:
  #   - default.svc.cluster.local
  # options:
  #   - name: ndots
  #     value: "5"

# Init containers
initContainers: []
  # - name: init-myservice
  #   image: busybox:1.28
  #   command: ['sh', '-c', 'until nslookup myservice; do echo waiting; sleep 2; done']

# Sidecar containers
sidecarContainers: []
  # - name: sidecar
  #   image: nginx:1.19
  #   ports:
  #     - containerPort: 80

nodeSelector: {}

tolerations: []

affinity: {}

# Topology spread constraints for pod distribution
topologySpreadConstraints: []
  # - maxSkew: 1
  #   topologyKey: topology.kubernetes.io/zone
  #   whenUnsatisfiable: DoNotSchedule
  #   labelSelector:
  #     matchLabels:
  #       app.kubernetes.io/name: hyperfleet-adapter

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Adapter configuration
config:
  # Use ConfigMap for adapter config
  # If enabled, creates a ConfigMap and mounts it
  # If disabled, uses packaged config from image
  enabled: true
  # ConfigMap name (if different from default)
  configMapName: ""
  # Adapter type identifier (e.g., "example", "gcp", "aws")
  adapterType: ""
  # Environment variables for ConfigMap (matching adapter-configmap-template.yaml structure)
  # Example for RabbitMQ:
  #   BROKER_TYPE: "rabbitmq"
  #   BROKER_HOST: "rabbitmq.hyperfleet-system.svc.cluster.local"
  #   BROKER_PORT: "5672"
  #   BROKER_QUEUE_NAME: "hyperfleet-cluster-events"
  #   BROKER_EXCHANGE: "hyperfleet-events"
  #   BROKER_MAX_CONCURRENCY: "100"
  env: {}
  # Alternative: YAML format configuration file (if adapter reads from adapter.yaml file)
  # This will create adapter.yaml key in ConfigMap
  adapterYaml: ""

# Broker configuration
broker:
  # Create a broker ConfigMap (if false, you must provide an existing configMapName)
  create: false
  # Broker ConfigMap name
  # If create=true and configMapName is empty, generates name from release
  # If create=false, this must be an existing ConfigMap name
  configMapName: ""
  # Broker type identifier (googlepubsub, rabbitmq, etc.) - used as label
  type: ""
  # Subscription ID for the adapter to consume from (BROKER_SUBSCRIPTION_ID env var)
  subscriptionId: ""
  # Topic for the adapter to consume from (BROKER_TOPIC env var)
  topic: ""
  # Additional broker environment variables to add to ConfigMap
  # Example:
  #   BROKER_GOOGLEPUBSUB_PROJECT_ID: "my-gcp-project"
  #   SUBSCRIBER_PARALLELISM: "10"
  env: {}
  # Broker YAML configuration file content
  # When set, creates broker.yaml key in ConfigMap, mounts at /etc/broker/broker.yaml,
  # and sets BROKER_CONFIG_FILE=/etc/broker/broker.yaml
  # Example for Google Pub/Sub:
  # yaml: |
  #   broker:
  #     type: googlepubsub
  #     googlepubsub:
  #       project_id: "my-gcp-project"
  #       max_outstanding_messages: 1000
  #       num_goroutines: 10
  #   subscriber:
  #     parallelism: 10
  yaml: ""
  # Mount broker ConfigMap env vars (BROKER_SUBSCRIPTION_ID, BROKER_TOPIC, etc.) via envFrom
  # Set to false if you only need the broker.yaml file mounted
  mountAsEnv: true
  # List of specific environment variable keys to mount from broker ConfigMap
  # If empty and mountAsEnv=true, all keys will be available via envFrom
  envKeys: []

# HyperFleet API configuration
hyperfleetApi:
  # Base URL for HyperFleet API (HYPERFLEET_API_BASE_URL)
  baseUrl: ""
  # API version (HYPERFLEET_API_VERSION), default: v1
  version: "v1"

# Environment variables
env: []
  # - name: ADAPTER_CONFIG_PATH
  #   value: /path/to/custom/config.yaml
  # - name: MY_SECRET
  #   valueFrom:
  #     secretKeyRef:
  #       name: my-secret
  #       key: secret-key

# envFrom for loading entire ConfigMaps/Secrets as environment variables
envFrom: []
  # - configMapRef:
  #     name: my-configmap
  # - secretRef:
  #     name: my-secret

# Volume mounts for additional configs
extraVolumeMounts: []
  # - name: custom-config
  #   mountPath: /etc/custom
  #   readOnly: true

# Additional volumes
extraVolumes: []
  # - name: custom-config
  #   configMap:
  #     name: custom-configmap

# Pod Disruption Budget
podDisruptionBudget:
  enabled: false
  # minAvailable: 1
  # maxUnavailable: 1
  # unhealthyPodEvictionPolicy: IfHealthyBudget
